---
title: "Análisis del ruido en Madrid"
output: document_html
---
```{r}
library("dplyr")
library("ggplot2")
library('gridExtra')
```


```{r}
df <- read.csv(file = './data/datos_ruido_madrid.csv', header = FALSE, sep = ';', strip.white = TRUE)

colnames(df) <- c("Station","Year","Month","Day","Period","LAeq","LAS01","LAS10","LAS50","LAS90","LAS99")

df$Date <- as.Date(with(df, paste(Year, Month, Day,sep="-")), "%Y-%m-%d")

head(df)
```

Calculamos la media de los índices por año, mes, estación y periodo, y añadimos las variables al dataframe.

```{r}

meanLAeqByMonthStationAndPeriod <- df %>% 
    group_by(Year,Month, Station, Period) %>% 
    summarise(meanLAeqByMonth = mean(LAeq), 
              meanLAS01ByMonth = mean(LAS01), 
              meanLAS10ByMonth = mean(LAS10),
              meanLAS50ByMonth = mean(LAS50),
              meanLAS90ByMonth = mean(LAS90),
              meanLAS99ByMonth = mean(LAS99))

df <- merge(df, meanLAeqByMonthStationAndPeriod, by = c("Year","Month", "Station", "Period"), all.x = TRUE)

colnames(df)

head(df)
```

Nos centramos únicamente en el índice LAeq durante el periodo 'T'. Nos interesa conocer la media mensual por año de ese índice para cada una de las estaciones de Madrid. 

```{r}
 b <- df %>%  filter(Year==2015) %>% filter(Period == "T")

```


```{r, fig.width = 10, fig.height = 20}

ggplot(b, aes(x = Month, y = meanLAeqByMonth)) +
 geom_point(color="steelblue", size=1)  +
 geom_line(color="steelblue", size=0.5)  +
 facet_wrap(~ Station, ncol = 3, scales="free") +
  labs(title = "Comparación LAeq ",
       subtitle = "Comparación evolución LAeq promedio años (2015-2019) y 2020 para las distintas estaciones",
       y = "Media mensual LAeq", x = "Mes")
```


